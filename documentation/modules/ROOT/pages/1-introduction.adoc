= 1. 소개 - 10분
:imagesdir: ../assets/images

[NOTE]
====
이전 모듈의 '소개' 랩을 이미 완료했다면 바로 'CI/CD 파이프라인 구축' 랩으로 넘어가도 됩니다.
====

워크로드를 클라우드로 마이그레이션하거나 현대화하는 일반적인 방법론을 *6R 프레임워크* 라고 합니다. 이 프레임워크는 다음과 같이 세분화할 수 있습니다.

image::mod-strategies-m3.png[Modernization Strategies]

[IMPORTANT]
====
Globex의 개발자는 이미 https://access.redhat.com/documentation/en-us/migration_toolkit_for_applications/6.0/html-single/introduction_to_the_migration_toolkit_for_applications/index[Migration Toolkit for Applications(MTA)^] 평가 및 분석 도구를 사용하여 레거시 애플리케이션(*customers*)을 Red Hat OpenShift로 현대화했습니다. 그동안 SRE 팀은 `모듈 1 과 `2` 를 통해 PostgreSQL 데이터베이스를 OpenShift로 마이그레이션하는 작업도 완료했습니다.
====

이 모듈은 다음 단계에 따라 고급 빌드 및 배포 기능을 구축하기 위한 2가지 단계(_파이프라인_, _GitOps_)를 안내합니다.

* 다음의 주요 기능을 사용하여 링크:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.11/html-single/cicd/index#op-detailed-concepts[OpenShift Pipeline^]를 기반으로 지속적인 통합 및 지속적인 배포(CI/CD)를 구축합니다.

** 격리된 컨테이너에서 필요한 모든 종속성을 갖춘 파이프라인을 실행하는 서버리스 CI/CD 시스템을 빌드할 수 있도록 합니다.
** 분산 팀이 마이크로서비스 기반 아키텍처에서 자동화 작업을 설계할 수 있도록 허용합니다.
** 기존 Kubernetes 도구와 쉽게 확장 및 통합할 수 있는 표준 CI/CD 파이프라인 정의를 사용하여 필요에 따라 확장할 수 있습니다.
** Source-to-Image(S2I), Buildah, Buildpacks, Kaniko와 같은 Kubernetes 도구를 사용하여 모든 Kubernetes 플랫폼에서 이식 가능한 이미지를 빌드할 수 있습니다.
** OpenShift Container Platform Developer 콘솔을 사용하여 Tekton 리소스를 생성하고, 파이프라인 실행 로그를 보고, OpenShift Container Platform 네임스페이스에서 파이프라인을 관리합니다.

* 링크:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.11/html-single/cicd/index#about-redhat-openshift-gitops_understanding-openshift-gitops[OpenShift GitOps (ArgoCD)^]를 사용하여 다음의 주요 기능을 갖춘 현대화된 애플리케이션을 Red Hat OpenShift에 배포합니다.

** 클러스터가 구성, 모니터링 및 저장에 대해 유사한 상태를 갖고 있는지 확인하십시오.
** 여러 OpenShift Container Platform 클러스터에 구성 변경 사항을 적용하거나 되돌립니다.
** 템플릿 구성을 다양한 환경과 연결
** 스테이징에서 프로덕션까지 클러스터 전반에 걸쳐 애플리케이션을 홍보합니다.
~!~!~!~

* link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.11/html-single/cicd/index#op-detailed-concepts[OpenShift Pipeline^]을 기반으로 다음과 같은 주요 기능을 갖춘 지속적 통합 및 지속적 배포(CI/CD) 시스템을 구축합니다:

** 필요한 모든 종속성을 격리된 컨테이너에서 실행하는 서버리스 CI/CD 시스템 구축할 수 있습니다. 
** 마이크로서비스 기반 아키텍처에서 분산된 팀이 자동화 작업을 설계할 수 있게 합니다. 
** 기존 Kubernetes 도구와 쉽게 통합 및 확장이 가능한 표준 CI/CD 파이프라인 정의를 사용하여 필요에 따라 확장할 수 있습니다. 
** Kubernetes 플랫폼 간에 이식 가능한 Source-to-Image (S2I), Buildah, Buildpacks, Kaniko와 같은 Kubernetes 도구를 사용하여 이미지를 빌드할 수 있습니다. 
** OpenShift Container Platform Developer 콘솔을 사용하여 Tekton 리소스를 생성하고, 파이프라인 실행 로그를 보고, OpenShift Container Platform 네임스페이스에서 파이프라인을 관리할 수 있습니다.

* link:https://access.redhat.com/documentation/en-us/openshift_container_platform/4.11/html-single/cicd/index#about-redhat-openshift-gitops_understanding-openshift-gitops[OpenShift GitOps (ArgoCD)^]를 사용하여 Red Hat OpenShift에 현대화된 애플리케이션을 다음과 같은 주요 기능과 함께 배포합니다:

** 클러스터들의 구성, 모니터링, 스토리지 상태가 유사하도록 보장합니다. 
** 여러 OpenShift Container Platform 클러스터에 구성 변경을 적용하거나 되돌릴 수 있습니다. 
** 템플릿화된 구성을 다양한 환경과 연계할 수 있습니다. 
** 애플리케이션을 클러스터 간에 승격하여 스테이징에서 프로덕션으로 이동시킵니다.

== 1.1. Globex 리테일 시스템 아키텍처 이해

Globex는 이 워크숍에서 사용할 가상의 회사입니다. 워크숍 환경의 Globex 시스템은 아래에 설명된 대로 가상머신과 컨테이너 플랫폼 등 여러 플랫폼에 배포된 마이크로서비스 애플리케이션으로 구성되어 있습니다.

image::architecture_initial_m3.png[architecture_initial_m3]

이 워크숍의 초기 상태는 레거시 가상화 및 Red Hat OpenShift 컨테이너 플랫폼에 걸쳐 있는 환경입니다.

애플리케이션은 레거시 환경에서 일부가 이미 OpenShift로 이전된 상태입니다.

Globex 리테일 애플리케이션은 _Node.js_ 프론트엔드 서비스로 구성되어 있으며, 데이터는 게이트웨이 서비스를 통해 가져옵니다. 게이트웨이 서비스는 세 개의 백엔드 서비스(customers, orders, inventory)와 연결되어 있으며, 각 서비스는 자체 데이터베이스를 사용해 데이터를 저장합니다.

OpenShift에서 실행 중인 서비스는 `retail-%USERID%` 네임스페이스에 배포됩니다. 이후 모듈에서 *OpenShift GitOps* 와 *Pipelines* 를 사용하여 이러한 서비스를 관리하게 됩니다.

[IMPORTANT]
====
**customers 파드가 _ImagePullBackOff Error_ 로 인해 실패한 상태일 수 있습니다. 나중에 OpenShift CI/CD 및 GitOps 섹션을 완료하면 자동으로 수정됩니다.**
====

애플리케이션의 모든 소스 코드와 모든 서비스의 GitOps YAML 매니페스트는 워크숍 목적으로 OpenShift 클러스터에 호스팅된 (Git 호환) *Gitea* 저장소에 저장됩니다.

현재 애플리케이션의 문제는 *customers* 서비스에 있습니다.

* customers 서비스는 Legacy Virtualization의 VM에서 Apache Tomcat에서 실행되는 오래된 Java 코드 기반을 사용합니다. 이 모듈에서는 이 레거시 Java 애플리케이션을 평가하고 분석하여 Java 코드를 현대화하고 Red Hat JBoss Web Server 위에 있는 OpenShift에 애플리케이션을 배포하는 가장 좋은 방법을 알아봅니다.
* customers 데이터베이스는 Legacy Virtualization에서 VM으로 실행되는 PostgreSQL 데이터베이스를 사용합니다. Globex의 IT 운영 팀은 고객 데이터베이스를 OpenShift 컨테이너화로 마이그레이션하여 현대화하려고 합니다.

이 워크숍의 모든 모듈을 완료했을 때 보이는 배포 아키텍처는 다음과 같습니다.

image::architecture_completed.png[architecture_completed]

== 1.2. 워크숍 환경

=== 1.2.1. 유저 이름을 확인하세요!

화면 상단의 상자를 살펴보세요. 유저 이름이 이미 설정되어 있나요? 그렇다면 다음과 같이 표시됩니다.

image::alreadyset.png[alreadyset]

`username` 이 제대로 설정되었다면 다음으로 넘어갈 수 있습니다. *그렇지 않다면 할당된 유저 ID를 위의 상자에 다음과 같이 입력하세요.*

image::setuser.png[setuser]

이렇게 하면 이 워크숍의 링크와 복사/붙여넣기 코드가 커스터마이징됩니다. 실수로 잘못된 유저 이름을 입력한 경우 URL 매개변수에서 유저 이름을 업데이트하기만 하면 됩니다(예: `1-introduction.html?USERID=%USERID%` )

[IMPORTANT]
====
핸즈온 랩을 실행하는 동안 *고유한 사용자 이름*(예: `%USERID%`)을 사용해야 합니다. 예를 들어, 자신의 프로젝트에 애플리케이션을 배포해야 합니다(예: retail-%USERID%).
====

=== 1.2.2. 오픈시프트 클러스터

귀하의 OpenShift 클러스터는 이미 필요한 모든 것이 구성되어 있습니다. 자세한 내용은 다음과 같습니다.

* 소스 코드 저장소를 호스팅하는 `Gitea`
* GitOps 접근 방식을 사용하여, ArgoCD를 통해 배포된 서비스를 관리하기 위한 `OpenShift GitOps`
* GitOps를 사용하여 소스 코드에서 고객 애플리케이션을 빌드하고 `retail` 프로젝트에 배포하기 위한 `OpenShift Pipelines`

=== 1.2.3. Visual Studio Code 서버

VSCode는 이미 OpenShift 클러스터에 배포되어 IDE로 사용할 수 있습니다. 즉, 시스템에 아무것도 설치하고 구성할 필요가 없습니다. 이렇게 하면 복제된 리포지토리에서 소스 코드와 구성 파일을 쉽게 변경할 수 있습니다.

시작하려면 링크: https://codeserver-codeserver-%USERID%.%SUBDOMAIN%[VS Code 서버 인스턴스^]에 액세스하고 다음 `비밀번호` 를 사용하여 로그인하세요.

* 비밀번호: `{openshift-password}`

image::vscode-server-login.png[vscode-server-login]

그래픽 사용자 인터페이스(GUI)는 다음과 같습니다.

image::vscode.png[VSCode]

== 1.3. OpenShift에 로그인

Frontend 웹 애플리케이션에 액세스하여 리테일 서비스 애플리케이션에 액세스할 수 있는지 확인하세요. *Frontend* 애플리케이션에 액세스할 URL을 찾으려면 OpenShift 명령줄 도구(`oc`)를 사용해야 합니다. 

VS Code 서버로 이동하여, _oc_ 명령어가 사전에 설치되어 있는 새 터미널을 엽니다.

VS Code의 Terminal 메뉴에서 `New Terminal` 을 클릭합니다. 새 터미널이 열리면 다음과 같이 _oc_ 명령어를 실행합니다.

[.console-input]
[source,bash]
----
oc login -u %USERID% -p openshift https://openshift.default.svc:443
----

image::vscode-terminal.png[vscode-terminal]

[NOTE]
====
복사/붙여넣기 허용에 대한 팝업 메시지가 나타나면, *"클립보드에 복사된 텍스트와 이미지를 확인하세요"*, `허용` 을 클릭합니다. 그러면 터미널에서 `"안전하지 않은 연결을 사용하시겠습니까?"` 라는 메시지가 표시될 수도 있습니다. 그럴 경우 `y` 를 누릅니다.
====

== 1.4 작업할 브랜치 변경

오늘 이 모듈에서 사용할 올바른 브랜치인 `ocp-4.15` 로 *check out* 하세요!

VS Code 터미널에서 다음 `git` 명령을 실행합니다.

[.console-input]
[source,bash]
----
git checkout ocp-4.15
----

출력은 다음과 같아야 합니다.

[.console-output]
[source,bash,subs="+attributes,macros+"]
----
branch 'ocp-4.15' set up to track 'origin/ocp-4.15'.
Switched to a new branch 'ocp-4.15'
----

== 축하합니다!

이제 애플리케이션 아키텍처에 대해 성공적으로 알아보고 워크숍 환경을 확인했습니다.

다음 단계에서는 코드로 구성(configuratioun)을 설정하고 GitOps 방식을 사용하여 빌드에서 테스트, 프로덕션까지 애플리케이션 라이프사이클을 자동화하여 현대화 프로세스를 계속 진행합니다.